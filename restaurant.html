<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script
      src="https://kit.fontawesome.com/772918bb67.js"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>

    <!--========== BOX ICONS ==========-->
    <link
      href="https://cdn.jsdelivr.net/npm/boxicons@2.0.5/css/boxicons.min.css"
      rel="stylesheet"
    />

    <!--========== CSS ==========-->
    <link rel="stylesheet" href="assets/css/styles.css" />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
      integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <style>
      .footer__content ul {
        padding: 0;
      }
    </style>

    <title>Responsive website food</title>
  </head>
  <body>
    <!--========== SCROLL TOP ==========-->
    <a href="#" class="scrolltop" id="scroll-top">
      <i class="bx bx-chevron-up scrolltop__icon"></i>
    </a>

    <!--========== HEADER ==========-->
    <header class="l-header" id="header">
      <nav class="nav bd-container">
        <a href="index.html" class="nav__logo">Group 2</a>

        <div class="nav__menu" id="nav-menu">
          <ul class="nav__list">
            <li class="nav__item">
              <a href="index.html" class="nav__link active-link">Home</a>
            </li>
            
            <li class="nav__item">
              <a href="" class="nav__link">Services</a>
            </li>
            
            <li class="nav__item">
              <a href="" class="nav__link">Contact us</a>
            </li>

            <li><i class="bx bx-moon change-theme" id="theme-button"></i></li>
          </ul>
        </div>

        <div class="nav__toggle" id="nav-toggle">
          <i class="bx bx-menu"></i>
        </div>
      </nav>
    </header>
   

    <main class="l-main">
      
      <!--========== HOME ==========-->
      <section class="home" id="home">
        <div class="home__container bd-container bd-grid">
          <div class="home__data">
            <h1 class="home__title"></h1>
            <h2 class="home__subtitle"></h2>
            <a href="#menu" class="button">View Menu</a>
          </div>

          <img alt="" class="home__img" />
        </div>
      </section>

      <!--========== ABOUT ==========-->
      <section class="about section bd-container" id="about">
        <div class="about__container bd-grid">
          <div class="about__data">
            <span class="section-subtitle about__initial">About</span>
            <h2 class="section-title about__initial"></h2>
            <p class="about__description"></p>
          </div>
          <div
            id="carouselExampleSlidesOnly"
            class="carousel slide about__img"
            data-bs-ride="carousel"
          >
            <div class="carousel-inner"></div>
          </div>
        </div>
      </section>

     
       <!--========== SERVICES ==========-->
       <section class="services section bd-container" id="services">
        <span class="section-subtitle"></span>
        <h2 class="section-title"></h2>

        <div class="services__container bd-grid">
          <div class="services__content mw-100 d-flex flex-column justify-content-center align-items-center ">
            <h3 class="services__title w-100 ">Đánh giá của bạn</h3>
            <div class="mt-3 mb-3 " id="userrating"></div>
            <div class="mb-3 w-100">
              <label for="exampleFormControlTextarea1" class="form-label w-100"
                >Bình luận</label
              >
              <textarea
                class="form-control w-100"
                id="exampleFormControlTextarea1"
                rows="3"
              ></textarea>
              <button type="button" class="btn btn-success mt-3" id="btnRating">
                Đánh giá
              </button>
            </div>
          </div>

          <div class="services__content">
            <h3 class="services__title d-flex mw-100 justify-content-center align-items-center">
              <span id="averageRating" class="h3 mr-3">0</span>
              <div id="rating" class="ms-3"></div>
            </h3>
            <p class="services__description">
                <div class="list-group"></div>
            </p>
          </div>
        </div>
      </section>

      <!--========== MENU ==========-->
      <section class="menu section bd-container" id="menu">
        <span class="section-subtitle">Menu</span>
        <h2 class="section-title"></h2>

        <div class="menu__container bd-grid"></div>
      </section>

      

      

      <!--========== CONTACT US ==========-->
      <section class="contact section bd-container" >
        <div class="contact__container bd-grid">
          <div class="contact__data">
            <span class="section-subtitle contact__initial"></span>
            <h2 class="section-title contact__initial">Liên Hệ</h2>
            <p class="contact__description">
                Liên hệ để được tư vấn đặt bàn ngay
            </p>
          </div>

          <div class="contact__button">
            <a href="#" class="button">Contact now</a>
          </div>
        </div>
      </section>
    </main>

    <!--========== FOOTER ==========-->
    <footer class="footer section bd-container">
      <div class="footer__container bd-grid">
        <div class="footer__content ">
          <a href="#" class="footer__logo">Nhóm 2</a>
          <span class="footer__description">Restaurant</span>
          <div>
            <a href="#" class="footer__social"
              ><i class="bx bxl-facebook"></i
            ></a>
            <a href="#" class="footer__social"
              ><i class="bx bxl-instagram"></i
            ></a>
            <a href="#" class="footer__social"
              ><i class="bx bxl-twitter"></i
            ></a>
          </div>
        </div>

        

        <div class="footer__content ">
          <h3 class="footer__title">Information</h3>
          <ul>
            <li><a href="#" class="footer__link">Event</a></li>
            <li><a href="#" class="footer__link">Contact us</a></li>
            <li><a href="#" class="footer__link">Privacy policy</a></li>
            <li><a href="#" class="footer__link">Terms of services</a></li>
          </ul>
        </div>

       
      </div>

      <p class="footer__copy">&#169; 2023 Group 2. All right reserved</p>
    </footer>

    <!--========== SCROLL REVEAL ==========-->
    <script src="https://unpkg.com/scrollreveal"></script>

    <!--========== MAIN JS ==========-->
    <!-- get data -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-analytics.js";
      import {
        getDatabase,
        ref,
        get,
        child,
        set,
        push,
      } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyBozbZWYjPfk8NJBvMy-S4owF1zv7-Q6eg",
        authDomain: "quanlynhahang-ee2e7.firebaseapp.com",
        databaseURL:
          "https://quanlynhahang-ee2e7-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "quanlynhahang-ee2e7",
        storageBucket: "quanlynhahang-ee2e7.appspot.com",
        messagingSenderId: "209540003825",
        appId: "1:209540003825:web:d191d664b278229dcaf650",
        measurementId: "G-P108TVWT4C",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);

      const db = getDatabase(app);
      const dbRef = ref(db);
      let data = [];

      const getData = async () => {
        const snapshot = await get(child(dbRef, `nhaHang/`));
        if (snapshot.exists()) {
          //   console.log(snapshot.val());
          data = Object.values(snapshot.val());
          console.log(data);
        } else {
          console.log("No data available");
        }
      };
      getData();

      const menu = document.querySelector(".menu__container");
      const home__title = document.querySelector(".home__title");
      const home__img = document.querySelector(".home__img");
      const about__description = document.querySelector(".about__description");
      const carousel_inner = document.querySelector(".carousel-inner");
      const contact__description = document.querySelector(".contact__description");
      const comment = document.querySelector(".list-group");
      const btnRating = document.querySelector("#btnRating");
      let detail = {};
      const urlsParams = new URLSearchParams(window.location.search);

      // cập nhật điểm đánh giá
      function updateAverageRating(average) {
        // Update the text of the span element
        $("#averageRating").text(average.toFixed(1));
      }

      //send data
      function handleSendData() {
        const idnh = urlsParams.get("idnh");
        const comment = document.querySelector(
          "#exampleFormControlTextarea1"
        ).value;
        const rating = $("#userrating").rateYo("rating");
        console.log(rating);
        const dbRef = ref(db, `nhaHang/${data[idnh].id}/danhGia`);
        const newPostRef = push(dbRef);
        set(newPostRef, rating);
        const dbRef2 = ref(db, `nhaHang/${data[idnh].id}/binhLuan`);
        const newPostRef2 = push(dbRef2);
        set(newPostRef2, comment);
        alert("Đánh giá thành công");
        window.location.reload();
      }
      btnRating.addEventListener("click", handleSendData);

      // map
      function getmap(address) {
        const geocodeUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(
          address
        )}`;
        fetch(geocodeUrl)
          .then((response) => response.json())
          .then((data) => {
            if (data.length > 0) {
              const latitude = parseFloat(data[0].lat);
              const longitude = parseFloat(data[0].lon);
              const location = { lat: latitude, lng: longitude };
              window.location = `https://www.google.com/maps?q=${location.lat},${location.lng}&z=17&hl=vi`;
            } else {
              console.error("Không tìm thấy địa chỉ.");
            }
          })
          .catch((error) => console.error("Lỗi khi gọi API Nominatim:", error));
      }

    
      // update UI
      const updateUi = async () => {
        await getData();
        const id = urlsParams.get("idnh");
        let star = Object.values(data[id].danhGia);
        let average = star.reduce((a, b) => a + b, 0) / star.length;
        const initRating = () => {
          $(function () {
            $("#rating").rateYo({
              rating: average,
              fullStar: true,
              readOnly: true,
              onSet: function (rating, rateYoInstance) {
                // Update the average rating value
                average = (average + rating) / 2;
                // Update the text of the span element
                updateAverageRating(average);
                // Log the rating to the console
                console.log(
                  "You rated " +
                    rating +
                    " stars. Average rating: " +
                    average.toFixed(1)
                );
              },
            });
          });
          updateAverageRating(average);
        };

        window.onload = initRating();

        $(function () {
          $("#userrating").rateYo({
            rating: 0,
            fullStar: true,
            // readOnly: true,
            onSet: function (rating, rateYoInstance) {
              // Update the average rating value
              average = (average + rating) / 2;
              // Update the text of the span element
              updateAverageRating(average);
              // Log the rating to the console
              console.log("You rated " + rating + " stars");
            },
          });
        });
        home__title.innerHTML = data[id].tenNhaHang;
        home__img.src = data[id].anhNhaHang;
        about__description.innerHTML = data[id].moTaNhaHang;
        contact__description.innerHTML = `
          <li>
            <a href="https://www.google.com/maps/search/?api=1&query=${data[id].diaChiNhaHang}"  class="footer__link">
              <i class="bx bx-location-plus"></i>  ${data[id].diaChiNhaHang}</a>
           </li>
          <li>
            <a href="#" class="footer__link"><i class="bx bx-envelope"></i>  ${data[id].email}</a>
            </li>
          <li>
            <a href="#" class="footer__link"> <i class="bx bx-phone-call"></i>  ${data[id].soDienThoai}
           </li>
        `;
        Object.entries(data[id].binhLuan).forEach(([key, value]) => {
          comment.innerHTML += `
          <a href="#" class="list-group-item list-group-item-action">${value}</a>
          `;
        });
        Object.entries(data[id].cacAnhNhaHang).forEach(([key, value]) => {
          if (key == "anh1") {
            carousel_inner.innerHTML += `
            <div class="carousel-item active">
                <img  src="${value}" class="d-block w-100 about__img" alt="..." />
            </div>`;
          } else {
            carousel_inner.innerHTML += `
            <div class="carousel-item">
                <img src="${value}" class="d-block w-100 about__img" alt="..." />
            </div>
        `;
          }
        });
        Object.entries(data[id].thucDon).forEach(([key, value]) => {
          menu.innerHTML += `
            <div class="menu__content">
                <img src="${value.hinhAnhMinhHoa}" alt="" class="menu__img" />
                <h3 class="menu__name">${value.tenMonAn}</h3>
                <span class="menu__detail">${value.moTaMonAn}</span>
                <span class="menu__preci">${value.giaMonAn.toLocaleString()} đ</span>
                <a href="#" class="button menu__button"
                ><i class="bx bx-cart-alt"></i
                ></a>
            </div>
        `;
        });
      };

      updateUi();
    </script>
    <script src="assets/js/main.js"></script>
  </body>
</html>
